<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة المنصات المتصفح</title>
    <style>
        /* توسيط اللعبة */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: sans-serif;
        }
        /* تصميم شاشة اللعب */
        canvas {
            border: 2px solid #333;
            background-color: #87ceeb; /* سماء زرقاء */
        }
    </style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="400"></canvas>

<script>
// --- إعدادات اللعبة ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const W = canvas.width;
const H = canvas.height;

// إعدادات اللاعب
let player = {
    x: 50,
    y: H - 50,
    width: 30,
    height: 30,
    color: 'blue',
    velX: 0,
    velY: 0,
    speed: 3,
    jumpStrength: -10,
    isJumping: false,
    onGround: false
};

const gravity = 0.6;
const friction = 0.8;

// --- نظام المراحل والمنصات (تدرج الصعوبة) ---
const LEVEL_DATA = {
    1: { // سهل
        platforms: [
            { x: 0, y: H - 20, w: W, h: 20, color: 'green' }, // الأرضية
            { x: 150, y: H - 80, w: 100, h: 20, color: 'green' },
            { x: 450, y: H - 150, w: 150, h: 20, color: 'green' }
        ],
        enemies: [],
        goalX: W - 40,
        message: "المرحلة 1: ابدأ بالقفز (مسافة قصيرة)"
    },
    2: { // متوسط
        platforms: [
            { x: 0, y: H - 20, w: W, h: 20, color: 'green' },
            { x: 80, y: H - 100, w: 80, h: 20, color: 'green' },
            { x: 300, y: H - 180, w: 50, h: 20, color: 'green' },
            { x: 550, y: H - 250, w: 100, h: 20, color: 'green' }
        ],
        enemies: [
            { x: 500, y: H - 45, w: 20, h: 20, color: 'red', speed: 1, range: 100, startX: 500 }
        ],
        goalX: W - 40,
        message: "المرحلة 2: احذر العدو المتحرك!"
    }
    // يمكن إضافة المزيد من المراحل هنا
};

let currentLevel = 1;
let platforms = [];
let enemies = [];
let goalX = W - 40;
let keys = {};
let gameActive = true;

// --- وظائف اللعبة ---

function loadLevel(levelNum) {
    const level = LEVEL_DATA[levelNum] || LEVEL_DATA[1];
    platforms = level.platforms;
    
    // إعداد الأعداء (نسخ البيانات لتكون مستقلة)
    enemies = level.enemies.map(e => ({ ...e, x: e.startX, direction: 1 }));
    
    goalX = level.goalX;
    
    // إعادة تعيين موضع اللاعب
    player.x = 50;
    player.y = H - 50;
    player.velX = 0;
    player.velY = 0;
    player.onGround = false;
    
    console.log(level.message);
}

function update() {
    if (!gameActive) return;

    // 1. حركة اللاعب
    
    // تطبيق الاحتكاك والجاذبية
    player.velX *= friction;
    player.velY += gravity;

    // الحد الأقصى للسرعة العمودية
    if (player.velY > 15) player.velY = 15;

    // التحكم الأفقي
    if (keys['ArrowRight'] || keys['d']) {
        player.velX += player.speed;
    }
    if (keys['ArrowLeft'] || keys['a']) {
        player.velX -= player.speed;
    }
    
    // القفز
    if ((keys[' '] || keys['w'] || keys['ArrowUp']) && player.onGround) {
        player.velY = player.jumpStrength;
        player.onGround = false;
    }
    
    // تطبيق الحركة
    player.x += player.velX;
    player.y += player.velY;

    // 2. فحص الاصطدام بالمنصات
    player.onGround = false;
    platforms.forEach(p => {
        // فحص الاصطدام (بسيط)
        if (
            player.x < p.x + p.w &&
            player.x + player.width > p.x &&
            player.y + player.height > p.y &&
            player.y < p.y + p.h
        ) {
            // الاصطدام العمودي (السقوط على المنصة)
            if (player.velY > 0
